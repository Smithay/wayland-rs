language: rust

cache: cargo

dist: trusty

sudo: required

rust:
  - stable

branches:
  only:
    - master

before_script:
  - export PATH=$HOME/.cargo/bin:$PATH
  - mkdir $(pwd)/socket
  - export XDG_RUNTIME_DIR="$(pwd)/socket"
  - env RUSTFLAGS="--cfg procmacro2_semver_exempt" cargo install cargo-tarpaulin --git https://github.com/vberger/tarpaulin.git --force
  - ./travis_install_wayland.sh "1.12.0"
  - export LD_LIBRARY_PATH="$HOME/install/lib:$LD_LIBRARY_PATH"

os:
  - linux

script:
  - |
      cargo tarpaulin --features "" --ignore-tests --out Xml && bash <(curl -s https://codecov.io/bash) -cF rust_impl
      cargo tarpaulin --features "native_lib" --ignore-tests --out Xml && bash <(curl -s https://codecov.io/bash) -cF native_lib

